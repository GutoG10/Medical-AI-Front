<app-header></app-header>

<div class="flex flex-col h-[calc(100vh-70px)] mx-auto
            bg-white shadow-lg
            w-full max-w-full lg:max-w-[90%] xl:max-w-[80%]
            overflow-visible transition-all">

  <div #scrollContainer class="flex-1 overflow-y-auto p-4 pb-20">

    <div class="flex flex-col justify-end grow space-y-2">

      @if (messages) {
      @for (msg of messages; track msg.id) {

      <div class="mb-4" [ngClass]="{ 'text-right': msg.foi_usuario }">

        <div [ngClass]="{
                'bg-[#19AA79]': msg.foi_usuario,
                'bg-[#198879]': !msg.foi_usuario
              }" class="inline-block text-white px-3 py-2 rounded-lg
                    max-w-[75%] md:max-w-[60%] lg:max-w-[50%]
                    wrap-break-words">

          @if (msg.foi_usuario) {
          <div class="text-left">{{ msg.text }}</div>
          } @else {
          <markdown [data]="msg.text"></markdown>
          }

        </div>
      </div>

      }
      }

      @if (firstMessage) {
      <app-sugestoes-component [titulo]="tituloSugestao" [opcoes]="opcoesSugestao"
        (eventoClick)="enviarSugestao($event)">
      </app-sugestoes-component>
      }

    </div>
  </div>

  <div class="sticky bottom-0 bg-white w-full border-t border-gray-200 z-30">
    <div class="mx-auto w-full max-w-full lg:max-w-[90%] xl:max-w-[80%]
                flex items-center justify-center space-x-3 p-4">

      <div class="relative flex-1 max-w-[700px] md:max-w-[60%] lg:max-w-[50%]">

        <input [(ngModel)]="newMessage" (keyup.enter)="enviarMensagem()" placeholder="Digite sua mensagem..." class="placeholder-[#19AA79] border-2 text-[#19AA79] text-[14px]
                 w-full border-[#D6E4EC] rounded-4xl px-3 py-2 pr-10
                 focus:outline-none focus:ring-2 focus:ring-[#19EE79]" />

        <button type="button" (click)="enviarMensagem()" class="absolute inset-y-0 right-3 flex items-center">
          <img src="assets/enviar.png" alt="enviar" class="w-5 h-5" />
        </button>

      </div>

      <button type="button" (click)="toggleGravacao()" [ngClass]="{
                'bg-red-600 animate-pulse': gravando,
                'bg-[#19AA79]': !gravando
              }" class="p-2 rounded-full text-white shadow transition hover:opacity-90">
        <img src="assets/mic.png" alt="Microfone" class="w-5 h-5" />
      </button>

    </div>
  </div>

</div>